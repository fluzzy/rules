# OpenAI 에이전트 설계 가이드

> **Source**: [OpenAI - A practical guide to building agents](https://cdn.openai.com/business-guides-and-resources/a-practical-guide-to-building-agents.pdf) (2025)

에이전트 설계 및 구축을 위한 핵심 원칙과 베스트 프랙티스.

---

## 핵심 목표

1. **자율적으로 워크플로우 실행**하고 필요에 따라 도구 선택/조합
2. **세 가지 구성요소 (Model, Tools, Instructions)** + **오케스트레이션과 가드레일** 체계적 구성
3. **계층화된 가드레일**과 **Human-in-the-loop** 경로로 안전성과 UX 보장

---

## 1. 에이전트 정의

단순 챗봇이나 단일 턴 모델과 달리 **LLM이 워크플로우 실행을 주도**, 도구 호출 및 종료 조건을 자율적으로 결정.

- **LLM 기반 실행 제어**: 완료 결정, 실패 시 중지/재시도, 필요 시 사용자에게 제어 반환
- **다양한 도구 사용**: 컨텍스트 수집/액션 실행을 위해 선택적으로 도구 호출

## 2. 에이전트 선택 시점

- **복잡한 의사결정**: 예외와 컨텍스트 의존적 판단이 규칙 엔진을 취약하게 만들 때
- **규칙 유지보수 증가**: 대규모 if-else/규칙 세트가 품질 저하 시킬 때
- **비정형 데이터 의존**: 자연어/문서/대화 기반 처리가 핵심일 때

조건이 불명확하면 **전통적 결정론적 자동화**가 더 적합할 수 있음.

## 3. 핵심 구성요소와 Run Loop

| 구성요소         | 설명                                         |
| ---------------- | -------------------------------------------- |
| **Model**        | 추론과 의사결정을 위한 두뇌                  |
| **Tools**        | 외부 시스템과 상호작용하는 함수/API/에이전트 |
| **Instructions** | 역할, 톤, 도구 사용 규칙, 종료 조건 명시     |

**Run loop (while-loop)**: 종료 조건까지 모델 응답 반복 실행

- 종료 예시: 최종 출력 도구 호출, 도구 호출 없는 모델 응답, 오류/턴 제한 초과

권장 흐름: **가장 강력한 모델 + 최소한의 필수 도구**로 기준선 생성 후 점진적 최적화

## 4. 도구 설계

**세 가지 도구 유형:**

| 유형              | 설명                        | 예시                                        |
| ----------------- | --------------------------- | ------------------------------------------- |
| **Data**          | 컨텍스트 수집               | DB/CRM 쿼리, 문서 읽기, 웹 검색             |
| **Action**        | 외부 상태 변경              | 메시지 전송, 레코드 업데이트, 티켓 핸드오프 |
| **Orchestration** | 다른 에이전트를 도구로 노출 | Research/Refund/Writer 에이전트             |

**리스크 등급**: 도구당 **Low/Med/High** 할당

- 읽기/쓰기, 되돌릴 수 있는지, 권한/재정 영향 기반
- 높은 등급은 추가 확인/가드레일/인간 승인 필요

## 5. Instructions 베스트 프랙티스

- **기존 운영 문서 활용**: SOP/지원 스크립트/정책 문서를 LLM 친화적 단계로 변환
- **작은 조각으로 분해**: 복잡한 지시를 번호가 매겨진 단계로 분리
- **명확한 액션 정의**: 각 단계에서 "무엇을 묻고/확인하고/실행할지" 명시
- **엣지 케이스 포함**: 정보 부족/예상치 못한 요청에 대한 분기 지시 추가

## 6. 오케스트레이션 패턴

**단일 에이전트 우선**: 도구를 점진적으로 추가, 복잡성 최소화

**멀티 에이전트로 전환 시점:**

- 복잡한 분기/조건이 프롬프트 확장을 어렵게 할 때
- 도구 과부하/중복이 모델의 잘못된 도구 선택을 유발할 때

**대표 패턴:**

- **Manager (agents-as-tools)**: 중앙 매니저가 도구 호출로 전문가 에이전트 오케스트레이션
- **Decentralized handoff**: 동등한 에이전트가 필요에 따라 핸드오프 도구로 제어 전달

## 7. 가드레일 (계층적 방어)

**입력/출력/도구 호출** 단계에서 계층적으로 가드레일 적용:

| 유형                | 설명                                          |
| ------------------- | --------------------------------------------- |
| **Relevance**       | 범위 이탈 감지                                |
| **Safety**          | 탈옥/프롬프트 인젝션 감지                     |
| **PII filter**      | 불필요한 개인정보 노출 방지                   |
| **Moderation**      | 유해 콘텐츠 차단                              |
| **Tool safeguards** | 도구 리스크에 따른 승인/차단/인간 검토 트리거 |
| **Rules-based**     | 입력 길이, 블랙리스트, 정규식 필터            |

**Optimistic execution + tripwires**: 메인 에이전트가 실행 진행하는 동안 가드레일 함수/에이전트가 병렬로 체크; 위반 시 예외 발생

## 8. Human-in-the-Loop

- **실패 임계값 초과**: 재시도/액션 횟수 초과 시 사용자/운영자 승인 요청 또는 제어 반환
- **고위험 액션**: 취소/환불/결제/민감 데이터 쓰기는 초기에 항상 인간 승인 필요
- **원활한 전환**: 에이전트가 완료할 수 없을 때, 컨텍스트를 인간에게 우아하게 전달하고 종료

---

## 실용 체크리스트

1. **적합성 검사**: 복잡한 판단, 규칙 피로, 비정형 데이터 필요 검토
2. **모델 기준선**: 가장 강력한 모델로 평가 기준선 수립 후 다운스케일링 테스트
3. **도구 카탈로그**: Data/Action/Orchestration 분류, 리스크 등급 할당
4. **Instructions 품질**: 기존 문서 → 번호가 매겨진 단계 지시로 변환, 엣지 케이스 포함
5. **오케스트레이션**: 단일 에이전트 run loop으로 시작, 필요 시 Manager/handoff 패턴으로 확장
6. **가드레일**: Relevance/Safety/PII/Moderation + Tool safeguards + 규칙 기반 필터
7. **Human-in-the-loop**: 실패 임계값과 고위험 액션에 대한 승인/에스컬레이션 경로 설정
