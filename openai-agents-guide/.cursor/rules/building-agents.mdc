---
description: OpenAI "A practical guide to building agents" 기반 에이전트 설계·운영 규칙
globs:
  - '**/*.{ts,tsx,js,jsx,py,md}'
alwaysApply: true
---

# 에이전트 빌드 규칙 (OpenAI Practical Guide)

## 1) 적합성 판단

- 자동화가 아닌 **복잡한 의사결정/엣지 케이스/비정형 데이터**가 핵심인지 확인합니다. 단순한 경우 전통적 결정적 로직을 우선합니다.

## 2) 모델 전략

- **가장 강력한 모델로 베이스라인 + 에발**로 정확도를 먼저 확보한 뒤, 비용/지연을 위해 작은 모델로 다운스케일 테스트합니다.
- 태스크 복잡도에 따라 **모델 믹스**를 고려합니다(간단한 분류/검색 ↔ 복잡한 판단).

## 3) 도구 설계

- 도구를 **Data / Action / Orchestration(다른 에이전트)** 로 분류하고, 이름/설명/파라미터/리턴을 표준화합니다.
- 각 도구에 **Low/Med/High 리스크**를 부여해 High는 추가 확인(가드레일/인간 승인/샌드박스)을 요구합니다.

## 4) 지시문 작성

- 기존 SOP/정책 문서를 **번호 있는 단계**로 변환하고, **명확한 행동/질문/출력**을 적습니다.
- **엣지 케이스**(정보 부족, 오프 토픽, 예상치 못한 요청) 처리 분기를 포함합니다.
- 필요 시 상위 모델(o1/o3-mini 등)로 초안을 생성한 뒤 사람이 검수합니다.

## 5) 오케스트레이션

- 기본은 **싱글 에이전트 런 루프**로 시작: 종료 조건(최종 출력 툴 호출, 툴 없는 응답, 에러/턴 한도)을 명시합니다.
- 프롬프트 템플릿에 정책 변수를 주입해 다목적 재사용을 높입니다.
- 멀티 에이전트로 확장 시:
  - **Manager (agents-as-tools)**: 중앙 매니저가 전문 에이전트를 툴로 호출 후 결과를 합성
  - **Decentralized handoff**: 에이전트가 **핸드오프 도구**로 제어를 넘기고 대화 상태를 이전
- 분기/조건이 폭증하거나 도구가 서로 헷갈릴 때만 멀티 에이전트를 고려합니다.

## 6) 가드레일 (레이어드)

- 입력/출력/툴 단계마다 병렬 가드레일을 둡니다(**낙관적 실행 + 트립와이어**).
- 필수 레이어: **Relevance**, **Safety(jailbreak/PII)**, **Moderation**, **Tool safeguards**, **Rules-based(길이/블랙리스트/regex)**, **Output validation**.
- 실사용 중 발견된 실패/엣지 케이스를 빠르게 규칙으로 추가합니다.

## 7) 인간 개입

- **실패 한계 초과**(재시도/행동 횟수) 또는 **고위험 액션**(결제/환불/민감 데이터 쓰기) 시 인간 승인 또는 에스컬레이션 경로를 필수로 둡니다.
- 제어를 넘길 때는 필요한 컨텍스트(요청, 중간 결과, 실패 이유)를 함께 전달합니다.

## 8) 체크리스트

1. 워크플로우가 에이전트에 적합한가? (복잡 판단/비정형 데이터)
2. 베이스라인 모델 + 에발 완료 후 다운스케일 시도했는가?
3. 도구 카탈로그화 및 리스크 등급 지정 완료했는가?
4. 지시문을 단계화하고 엣지 케이스를 포함했는가?
5. 런 루프 종료 조건을 정의했는가?
6. 멀티 에이전트가 필요한지 검증했는가? (Manager vs handoff)
7. Relevance/Safety/PII/Moderation/Tool safeguards 등의 가드레일을 켰는가?
8. 실패 한계·고위험 액션에 대한 인간 개입 경로가 있는가?
